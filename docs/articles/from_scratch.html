<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Implement interactive heatmap from scratch â€¢ InteractiveComplexHeatmap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Implement interactive heatmap from scratch">
<meta property="og:description" content="InteractiveComplexHeatmap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">InteractiveComplexHeatmap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.11.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/InteractiveComplexHeatmap_intro.html">How to visualize complex heatmaps interactively</a>
    </li>
    <li>
      <a href="../articles/implementation.html">How interactive complex heatmap is implemented</a>
    </li>
    <li>
      <a href="../articles/shiny_dev.html">Functions for Shiny app development</a>
    </li>
    <li>
      <a href="../articles/decoration.html">Decorations on heatmaps</a>
    </li>
    <li>
      <a href="../articles/interactivate_indirect.html">Interactivate heatmaps indirectly generated by pheatmap(), heatmap.2() and heatmap()</a>
    </li>
    <li>
      <a href="../articles/deseq2_app.html">A Shiny app for visualizing DESeq2 results</a>
    </li>
    <li>
      <a href="../articles/from_scratch.html">Implement interactive heatmap from scratch</a>
    </li>
    <li>
      <a href="../articles/share.html">Share interactive heatmaps to collaborators</a>
    </li>
    <li>
      <a href="https://www.biorxiv.org/content/10.1101/2021.03.08.434289v7.full.pdf" class="external-link">PDF version</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/InteractiveComplexHeatmap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Implement interactive heatmap from scratch</h1>
                        <h4 data-toc-skip class="author">Zuguang Gu ( <a href="mailto:z.gu@dkfz.de" class="email">z.gu@dkfz.de</a> )</h4>
            
            <h4 data-toc-skip class="date">2024-02-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/InteractiveComplexHeatmap/blob/HEAD/vignettes/from_scratch.Rmd" class="external-link"><code>vignettes/from_scratch.Rmd</code></a></small>
      <div class="hidden name"><code>from_scratch.Rmd</code></div>

    </div>

    
    
<style>
p {
    margin: 1em 0;
}
img {
    background-color: #FFFFFF;
    padding: 2px;
    border: 1px solid #DDDDDD;
    border-radius: 3px;
    border: 1px solid #CCCCCC;
    margin: 0 5px;
}
</style>
<p>In <strong>InteractiveComplexHeatmap</strong>, we mainly use the combination of <code><a href="../reference/InteractiveComplexHeatmapOutput.html">InteractiveComplexHeatmapOutput()</a></code> and <code><a href="../reference/makeInteractiveComplexHeatmap.html">makeInteractiveComplexHeatmap()</a></code> to create the interactive heatmap widget in the Shiny application. The interactive widgets contains many tools for manipulating heatmaps. However, sometimes users may want to build their own interactive heatmap widget, e.g. to define their own logic to respond to the clicking or brushing event on heatmaps, while not use the one provided by <strong>InteractiveComplexHeatmap</strong>. What they only want is the information of the heatmap cells that were selected from heatmaps.</p>
<p><strong>InteractiveComplexHeatmap</strong> also provides low-level functions that directly return the information of rows and columns that were selected from heatmap. I demonstrate the usage in the next example where <code>ui</code> and <code>server</code> are defined as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="va">...</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html" class="external-link">plotOutput</a></span><span class="op">(</span><span class="st">"heatmap"</span>, click <span class="op">=</span> <span class="st">"heatmap_click"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ht_obj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveVal.html" class="external-link">reactiveVal</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="va">ht_pos_obj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveVal.html" class="external-link">reactiveVal</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">heatmap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">...</span></span>
<span>        <span class="va">ht</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html" class="external-link">draw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">Heatmap</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">ht_pos</span> <span class="op">=</span> <span class="fu"><a href="../reference/htPositionsOnDevice.html">htPositionsOnDevice</a></span><span class="op">(</span><span class="va">ht</span><span class="op">)</span></span>
<span>        <span class="fu">ht_obj</span><span class="op">(</span><span class="va">ht</span><span class="op">)</span></span>
<span>        <span class="fu">ht_pos_obj</span><span class="op">(</span><span class="va">ht_pos</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">heatmap_click</span>, <span class="op">{</span></span>
<span>        <span class="va">pos</span> <span class="op">=</span> <span class="fu"><a href="../reference/getPositionFromClick.html">getPositionFromClick</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">heatmap_click</span><span class="op">)</span></span>
<span>        <span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="../reference/selectPosition.html">selectPosition</a></span><span class="op">(</span><span class="fu">ht_obj</span><span class="op">(</span><span class="op">)</span>, <span class="va">pos</span>, mark <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>            ht_pos <span class="op">=</span> <span class="fu">ht_pos_obj</span><span class="op">(</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="co"># do something with `df`</span></span>
<span>        <span class="va">...</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>There are two points that need to be noted.</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html" class="external-link">draw()</a></code> and <code><a href="../reference/htPositionsOnDevice.html">htPositionsOnDevice()</a></code> should always be executed together and be put inside <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot()</a></code> so that positions of all heatmap slices can be correctly calculated.</li>
<li>Use <code><a href="../reference/getPositionFromClick.html">getPositionFromClick()</a></code> to retrieve the position of the click on heatmap, then the position can be sent to <code><a href="../reference/selectPosition.html">selectPosition()</a></code> to correspond to the original matrix. Similarly, <code><a href="../reference/getPositionFromBrush.html">getPositionFromBrush()</a></code> and <code><a href="../reference/selectArea.html">selectArea()</a></code> work together to retrieve rows and columns of the matrix that correspond to the area selected from heatmap.</li>
</ol>
<p>The variable <code>df</code> contains row indices and column indices for the cells that were selected (check the help page of <code><a href="../reference/selectPosition.html">selectPosition()</a></code> and <code><a href="../reference/selectArea.html">selectArea()</a></code> to see the format of <code>df</code>). With this information, it is possible to implement the interactive heatmap widget from scratch.</p>
<p><code>htShinyExample(5.8)</code> demonstrates an example where the interactivity of the heatmap is only implemented with the functions from <strong>shiny</strong>. In this example, the main heatmap visualizes a 2D density distribution, and brushing on heatmap triggers a new 2D density estimation but only on the selected subset of data. The source code that generates this example is also includes in this web application.</p>
<p><img src="https://user-images.githubusercontent.com/449218/113612404-1479aa80-9650-11eb-8647-0f06cd1b7779.gif" width="100%"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  <style>nav[data-toggle='toc'] .nav .nav {display: block;}</style>
</body>
</html>
